<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Family Meals</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f5f5f5;
      padding: 18px;
      color: #111;
    }

  nav {
      background-color: #333;
      overflow: hidden;
    }
    nav a {
      float: left;
      display: block;
      color: white;
      text-align: center;
      padding: 14px 20px;
      text-decoration: none;
    }
    nav a:hover {
      background-color: #575757;
    }
    nav a.active {
      background-color: #4CAF50;
    }


    h1 { text-align:center; margin-bottom:6px; }

    /* legend */
    .legend {
      max-width:560px;
      margin: 6px auto 16px;
      text-align:center;
      font-size:14px;
    }
    .legend .dot { width:12px; height:12px; border-radius:50%; display:inline-block; margin:0 6px; vertical-align:middle; }
    .legend span { margin: 0 10px; }

    .filters {
      text-align:center;
      margin-bottom: 14px;
    }
    .filters label { margin: 0 10px; font-weight:600; }

    ul#mealList {
      list-style:none;
      padding:0;
      margin: 10px auto;
      max-width:720px;
    }
    ul#mealList li {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      background:#fff;
      margin:8px 0;
      padding:10px 12px;
      border-radius:8px;
      box-shadow:0 4px 12px rgba(0,0,0,0.05);
    }
    ul#mealList li.highlight {
      background: #fff7e6;
      border: 1px solid #ffd28a;
      font-weight:700;
    }
    .meal-name { flex:1; text-align:left; padding-right:12px; }

    .likes { display:flex; gap:8px; align-items:center; }
    .likes .dot { width:13px; height:13px; border-radius:50%; display:inline-block; }
    .dot-mum { background: pink; }
    .dot-dad { background: green; }
    .dot-summer { background: red; }

    #squanch {
      display:block;
      margin: 18px auto;
      background:#ff6ec7;
      color:white;
      border:none;
      padding:10px 18px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      box-shadow:0 6px 12px rgba(0,0,0,0.08);
    }
    #squanch:hover { background:#e055a9; }

    #randomMeal {
      text-align:center;
      margin-top:14px;
      font-size:18px;
      min-height:22px;
      font-weight:700;
    }

    .small-note { text-align:center; font-size:12px; color:#666; margin-top:8px; }
    @media (max-width:640px) {
      ul#mealList li { flex-direction:column; align-items:stretch; text-align:center; }
      .meal-name { padding-right:0; }
      .likes { justify-content:center; margin-top:8px; }
    }
  </style>
</head>
<body>
 <nav>
    <a href="index.html" class="active">Meal Ideas</a>
    <a href="recipes.html">Recipes</a>
  </nav>
  <h1>üçΩ Family Meals</h1>

  <div class="legend" aria-hidden="true">
    <span class="dot dot-mum"></span> <span> Mum</span>
    <span style="margin-left:12px" class="dot dot-dad"></span> <span> Dad</span>
    <span style="margin-left:12px" class="dot dot-summer"></span> <span> Summer</span>
  </div>

  <div class="filters" role="region" aria-label="Who is eating">
    <label><input type="checkbox" id="Mum" value="Mum" checked> Mum</label>
    <label><input type="checkbox" id="Dad" value="Dad" checked> Dad</label>
    <label><input type="checkbox" id="Summer" value="Summer" checked> Summer</label>
  </div>

  <ul id="mealList" aria-live="polite">
    <!-- meals inserted here -->
  </ul>

  <button id="squanch">üçÄ Squanch</button>
  <div id="randomMeal" aria-live="polite"></div>
  <div class="small-note">Tip: if you uncheck everyone, the full list is shown.</div>

  <script>
    // Helper: normalize incoming JSON (works with a few common layouts)
    function normalizeMeals(raw) {
      // raw may be an array directly or an object { meals: [...] }
      const arr = Array.isArray(raw) ? raw : (Array.isArray(raw.meals) ? raw.meals : []);
      return arr.map(item => {
        const name = item.meal || item.name || item.title || "Unnamed meal";
        const likesRaw = item.likedBy || item.likedby || item.likes || item.liked_by || item.LikedBy || [];
        const likes = Array.isArray(likesRaw) ? likesRaw.map(x => String(x).trim()) : [];
        return { name, likes };
      });
    }

    // Load JSON and initialize
    document.addEventListener('DOMContentLoaded', async () => {
      const mealListEl = document.getElementById('mealList');
      const randomEl = document.getElementById('randomMeal');
      const checkboxes = Array.from(document.querySelectorAll('.filters input'));

      let allMeals = [];
      let currentMeals = [];

      async function load() {
        try {
          const res = await fetch('meals.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('Could not fetch meals.json: ' + res.status);
          const raw = await res.json();
          allMeals = normalizeMeals(raw);
        } catch (err) {
          console.error(err);
          mealListEl.innerHTML = '<li style="background:#ffecec;color:#900;">Failed to load meals.json</li>';
          return;
        }
        update(); // initial render
      }

      function getSelectedPeople() {
        return checkboxes.filter(cb => cb.checked).map(cb => cb.value);
      }

      function filterMeals() {
        const selected = getSelectedPeople();
        if (selected.length === 0) return allMeals.slice();
        return allMeals.filter(m => selected.every(p => m.likes.includes(p)));
      }

      function renderList(meals, highlightName = null) {
        mealListEl.innerHTML = '';
        if (meals.length === 0) {
          const li = document.createElement('li');
          li.textContent = 'No meals match the current filters.';
          li.style.textAlign = 'center';
          mealListEl.appendChild(li);
          return;
        }

        meals.forEach(m => {
          const li = document.createElement('li');

          const nameSpan = document.createElement('div');
          nameSpan.className = 'meal-name';
          nameSpan.textContent = m.name;

          const likesDiv = document.createElement('div');
          likesDiv.className = 'likes';
          // add dots in consistent order Mum, Dad, Summer (if present)
          if (m.likes.includes('Mum')) {
            const s = document.createElement('span'); s.className = 'dot dot-mum'; s.title = 'Mum likes this'; likesDiv.appendChild(s);
          }
          if (m.likes.includes('Dad')) {
            const s = document.createElement('span'); s.className = 'dot dot-dad'; s.title = 'Dad likes this'; likesDiv.appendChild(s);
          }
          if (m.likes.includes('Summer')) {
            const s = document.createElement('span'); s.className = 'dot dot-summer'; s.title = 'Summer likes this'; likesDiv.appendChild(s);
          }

          li.appendChild(nameSpan);
          li.appendChild(likesDiv);

          if (highlightName && m.name === highlightName) li.classList.add('highlight');

          mealListEl.appendChild(li);
        });
      }

      function update() {
        currentMeals = filterMeals();
        renderList(currentMeals);
        randomEl.textContent = '';
      }

      // checkbox listeners
      checkboxes.forEach(cb => cb.addEventListener('change', update));

      // Squanch button
      document.getElementById('squanch').addEventListener('click', () => {
        if (!currentMeals || currentMeals.length === 0) {
          randomEl.textContent = 'No meals to pick from.';
          return;
        }
        const idx = Math.floor(Math.random() * currentMeals.length);
        const chosen = currentMeals[idx].name;
        randomEl.textContent = 'üëâ ' + chosen;
        renderList(currentMeals, chosen);
        // optional: scroll highlight into view
        setTimeout(() => {
          const highlighted = document.querySelector('li.highlight');
          if (highlighted) highlighted.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 80);
      });

      // initial load
      await load();
    });
  </script>
</body>
</html>
